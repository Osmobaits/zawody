{# File: templates/zawodnicy.html #}
{% extends "base.html" %}

{% block title %}Zarządzaj Zawodnikami{% endblock %}

{% block content %}
    <h2>Zarządzaj Zawodnikami</h2>

    {# Informacja o aktualnych zawodach (opcjonalnie) #}
    {% if session.get('current_zawody_nazwa') %}
        <p class="text-muted">Dla zawodów: {{ session['current_zawody_nazwa'] }}</p>
    {% endif %}

    <hr>

    {# === SEKCJA WCZYTYWANIA Z PLIKU === #}
    <div class="card mb-4 shadow-sm">
        <div class="card-header">
            <i class="bi bi-file-earmark-arrow-up-fill me-1"></i> Wczytaj zawodników z pliku (.txt)
        </div>
        <div class="card-body">
            <p class="card-text small text-muted">
                Wybierz plik tekstowy (.txt) zawierający listę zawodników (jedno imię i nazwisko w każdej linii). Kodowanie pliku powinno być UTF-8.
                <br><strong>Uwaga:</strong> Wczytanie pliku <strong>zastąpi</strong> wszystkich obecnych zawodników (włącznie z pustymi miejscami) i <strong>zresetuje</strong> wyniki losowania oraz wyniki wagowe dla tych zawodów.
            </p>
            {# Nowy formularz do uploadu #}
            <form method="POST" action="{{ url_for('zawodnicy') }}" enctype="multipart/form-data">
                 {# Dodajemy ukryte pole lub inny sposób identyfikacji formularza, jeśli potrzebne #}
                 {# LUB po prostu sprawdzimy obecność pliku w request.files w widoku #}
                <div class="input-group">
                    <input type="file" class="form-control" id="zawodnicyFile" name="zawodnicy_file" accept=".txt" required>
                    <button class="btn btn-info" type="submit" id="uploadButton"><i class="bi bi-upload me-1"></i> Wczytaj i Zastąp</button>
                </div>
                 <small class="form-text text-danger mt-1">Operacja jest nieodwracalna dla listy zawodników!</small>
            </form>
        </div>
    </div>
    {# === KONIEC SEKCJI WCZYTYWANIA Z PLIKU === #}

    <hr>

    {# Formularz dodawania pojedynczego zawodnika (bez zmian) #}
    <div class="card mb-4 shadow-sm">
        <div class="card-header">
             <i class="bi bi-person-plus-fill me-1"></i> Dodaj pojedynczego zawodnika
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('zawodnicy') }}">
                {{ form.hidden_tag() }} {# CSRF z formularza ZawodnikForm #}
                 <div class="form-group mb-3">
                    {{ form.imie_nazwisko.label(class="form-label") }}
                    {{ form.imie_nazwisko(class="form-control" + (" is-invalid" if form.imie_nazwisko.errors else ""), placeholder="Imię i Nazwisko") }}
                    {% if form.imie_nazwisko.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.imie_nazwisko.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                 </div>
                {{ form.submit(class="btn btn-success") }} {# Przycisk z formularza ZawodnikForm #}
            </form>
        </div>
    </div>

    <hr>

    {# Lista zawodników i formularz edycji (bez zmian w logice wyświetlania/edycji) #}
    <h3>Obecna lista zawodników</h3>
    {# Zakładam, że tu jest formularz obejmujący całą tabelę do edycji #}
    <form method="POST" action="{{ url_for('edytuj_zawodnikow') }}">
         {# ... Twoja tabela z listą zawodników i polami input do edycji ... #}
         {# Przykład wiersza (musisz dostosować do swojej implementacji tabeli): #}
         {#
         <tr>
             <td>
                 <input type="text" name="imie_nazwisko_{{ zawodnik.id }}" value="{{ zawodnik.imie_nazwisko or '' }}" class="form-control form-control-sm">
             </td>
             <td>
                 <form action="{{ url_for('usun_zawodnika', id=zawodnik.id) }}" method="POST" style="display: inline;" onsubmit="...">
                     <button type="submit" class="btn btn-danger btn-sm">Usuń</button>
                 </form>
             </td>
         </tr>
         #}
         {# Przycisk zapisu zmian dla formularza edycji #}
         <button type="submit" class="btn btn-warning mt-3"><i class="bi bi-pencil-square me-1"></i> Zapisz zmiany w liście</button>
    </form>

{% endblock %}